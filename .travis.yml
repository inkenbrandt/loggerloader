language: python

python:
  - "3.7"
  - "3.8"

sudo: required

before_install:
  - pip install pytest
  - "export DISPLAY=:99.0"

env:
  - DEPS="numpy matplotlib pandas"
    TWINE_USERNAME: ${{ secrets.PYPI_USERNAME }}
    TWINE_PASSWORD: ${{ secrets.PYPI_PASSWORD }}

install:
  - pip install codecov
  - pip install mock
  - pip install pytest-cov
  - pip install -r requirements.txt

script:
  - pytest test/test.py --cov=./

deploy:
  runs-on: ubuntu-latest
  steps:
  - uses: actions/checkout@v2
  - name: Set up Python
    uses: actions/setup-python@v1
    with:
      python-version: '3.x'
  - name: Install dependencies
    run: |
      python -m pip install --upgrade pip
      pip install setuptools wheel twine
  - name: Build and publish
    env:
      TWINE_USERNAME: ${{ secrets.PYPI_USERNAME }}
      TWINE_PASSWORD: ${{ secrets.PYPI_PASSWORD }}
    run: |
      python setup.py sdist bdist_wheel
      twine upload dist/*

after_success:
  - codecov

